<h1>Airline Dashboard</h1>

<form (ngSubmit)="search()" class="form">
  <label>
    From (IATA)
    <input [(ngModel)]="from" name="from" maxlength="3" placeholder="ZRH" />
  </label>

  <label>
    To (IATA)
    <input [(ngModel)]="to" name="to" maxlength="3" placeholder="FRA" />
  </label>

  <label>
    Datum
    <input type="date" [(ngModel)]="date" name="date" />
  </label>

  <button type="submit" [disabled]="loading()">Suchen</button>
</form>

<div *ngIf="loading()" class="info">Lade Fl√ºge...</div>
<div *ngIf="error()" class="error">{{ error() }}</div>

<table *ngIf="rows().length" class="flights-table">
  <thead>
  <tr>
    <th>Flug</th>
    <th>Abflug</th>
    <th>Ankunft</th>
    <th>Operator</th>
  </tr>
  </thead>
  <tbody>
  <tr *ngFor="let r of rows()" (click)="loadDetails(r.flight)" class="clickable">
    <td>{{ r.flight }}</td>
    <td>{{ r.dep }}</td>
    <td>{{ r.arr }}</td>
    <td>{{ r.op }}</td>
  </tr>
  </tbody>
</table>

<div *ngIf="loadingDetails()" class="info">Lade Fluginfos...</div>

<div *ngIf="selectedFlight" class="card">
  <h2>
    {{ selectedFlight?.MarketingCarrier?.AirlineID }}
    {{ selectedFlight?.MarketingCarrier?.FlightNumber }}
    <span *ngIf="selectedFlight?.OperatingCarrier?.AirlineID">
      (operated by {{ selectedFlight?.OperatingCarrier?.AirlineID }}
      {{ selectedFlight?.OperatingCarrier?.FlightNumber }})
    </span>
  </h2>

  <p class="status">
    Status: <strong>{{ selectedFlight?.FlightStatus?.Definition ?? 'NA' }}</strong>
  </p>
  <p>Maschine: {{ selectedFlight?.Equipment?.AircraftCode ?? 'unbekannt' }}</p>

  <div class="details">
    <div>
      <h3>Abflug</h3>
      <p>
        {{ selectedFlight?.Departure?.AirportCode }}
        &middot; geplant: {{ selectedFlight?.Departure?.ScheduledTimeLocal?.DateTime }}
        <span *ngIf="selectedFlight?.Departure?.ActualTimeLocal?.DateTime">
          &middot; effektiv: {{ selectedFlight?.Departure?.ActualTimeLocal?.DateTime }}
        </span>
        <span *ngIf="selectedFlight?.Departure?.Terminal?.Gate">
          &middot; Gate: {{ selectedFlight?.Departure?.Terminal?.Gate }}
        </span>
      </p>
    </div>

    <div>
      <h3>Ankunft</h3>
      <p>
        {{ selectedFlight?.Arrival?.AirportCode }}
        <span *ngIf="selectedFlight?.Arrival?.Terminal?.Name">
          &middot; Terminal: {{ selectedFlight?.Arrival?.Terminal?.Name }}
        </span>
        &middot; geplant: {{ selectedFlight?.Arrival?.ScheduledTimeLocal?.DateTime }}
        <span *ngIf="selectedFlight?.Arrival?.ActualTimeLocal?.DateTime">
          &middot; effektiv: {{ selectedFlight?.Arrival?.ActualTimeLocal?.DateTime }}
        </span>
        <span *ngIf="selectedFlight?.Arrival?.Terminal?.Gate">
          &middot; Gate: {{ selectedFlight?.Arrival?.Terminal?.Gate }}
        </span>
      </p>
    </div>
  </div>
</div>
